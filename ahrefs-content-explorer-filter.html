<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahrefs Niche Finder - Content Explorer Analytics</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
     <script src="auth-guard.js"></script>
    <script src="resource-protection.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #06b6d4;
            --gradient-primary: linear-gradient(135deg, #6366f1, #8b5cf6);
            --gradient-secondary: linear-gradient(135deg, #06b6d4, #3b82f6);
            --gradient-accent: linear-gradient(135deg, #f59e0b, #f97316);
            --background-color: #f8fafc;
            --surface-color: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-colored: 0 10px 25px -5px rgba(99, 102, 241, 0.25), 0 4px 6px -2px rgba(99, 102, 241, 0.1);
            --sidebar-width: 380px;
        }

        [data-theme="dark"] {
            --background-color: #0f172a;
            --surface-color: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
            --shadow-colored: 0 10px 25px -5px rgba(99, 102, 241, 0.4), 0 4px 6px -2px rgba(99, 102, 241, 0.2);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--surface-color);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .logo i {
            font-size: 2rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-toggle {
            display: none;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            color: var(--text-primary);
        }

        .sidebar-toggle:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .theme-toggle {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            color: var(--text-primary);
        }

        .theme-toggle:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        /* Main Layout */
        .main-layout {
            flex: 1;
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            height: calc(100vh - 80px);
            overflow-y: auto;
            position: fixed;
            top: 73px;
            left: 0;
            width: 400px;
            padding: 18px 20px 10px 20px;
            background-color: var(--background-color);
            border-right: 1px solid #ddd;
            scroll-behavior: smooth;
            scrollbar-width: thin;
            scrollbar-color: #ccc transparent;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background-color: #ccc;
            border-radius: 4px;
        }

        .sidebar.collapsed {
            margin-left: calc(-1 * var(--sidebar-width));
        }

        .sidebar-content {
            padding: 2rem;
            height: 100%;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: var(--background-color);
            margin-left: 400px;
        }

        /* Cards */
        .card {
            background: var(--surface-color);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-icon {
            font-size: 1.25rem;
            color: var(--primary-color);
        }

        /* Upload Section */
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
            margin-bottom: 2rem;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            box-shadow: var(--shadow-colored);
        }

        .upload-area.dragover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            transform: scale(1.02);
            box-shadow: var(--shadow-colored);
        }

        .upload-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .file-input {
            display: none;
        }

        .upload-button {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
            box-shadow: var(--shadow-md);
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-colored);
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .filter-group {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .filter-group-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--surface-color);
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .filter-item:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        .filter-checkbox {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--primary-color);
        }

        .filter-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            flex: 1;
        }

        /* Priority Categories */
        .priority-category {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(249, 115, 22, 0.1));
            border: 2px solid var(--warning-color);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-md);
        }

        .priority-category .filter-item {
            background: rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }

        [data-theme="dark"] .priority-category .filter-item {
            background: rgba(45, 55, 72, 0.9);
        }

        /* Key Business Areas */
        .key-business-areas {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 2px solid var(--primary-color);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-md);
        }

        .key-business-areas .filter-item {
            background: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        [data-theme="dark"] .key-business-areas .filter-item {
            background: rgba(45, 55, 72, 0.9);
        }

        /* Website Purpose */
        .website-purpose {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
            border: 2px solid var(--success-color);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-md);
        }

        .website-purpose .filter-item {
            background: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        [data-theme="dark"] .website-purpose .filter-item {
            background: rgba(45, 55, 72, 0.9);
        }

        /* Input Fields */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .input-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .input-field {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--surface-color);
            color: var(--text-primary);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-colored);
        }

        .btn-secondary {
            background: var(--surface-color);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .upload-area h3 {
            font-size: 0.875rem;
            color: var(--text-primary);
            word-wrap: break-word;
            word-break: break-all;
            max-width: 100%;
            overflow-wrap: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--gradient-secondary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #0ea5e9, #3b82f6);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.25), 0 4px 6px -2px rgba(6, 182, 212, 0.1);
        }

        .process-button {
            width: 100%;
            padding: 1rem 2rem;
            font-size: 1.125rem;
            margin-top: 2rem;
        }

        .bulk-action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .bulk-action-buttons .btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Category Control Buttons */
        .category-control-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .category-control-buttons .btn {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            flex: 1;
            min-width: 120px;
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(99, 102, 241, 0.2);
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-colored);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Category Tags */
        .category-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .category-tag {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(99, 102, 241, 0.2);
            box-shadow: var(--shadow-sm);
        }

        .category-tag:hover {
            background: var(--gradient-primary);
            color: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-colored);
        }

        .category-tag.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-colored);
        }

        /* Table */
        .table-container {
            background: var(--surface-color);
            border-radius: 0.75rem;
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
        }

        .table-controls {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: top;
        }

        .table tr:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.02), rgba(139, 92, 246, 0.02));
        }

        .website-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .website-link:hover {
            text-decoration: underline;
        }

        .traffic-value {
            font-weight: 600;
            color: var(--success-color);
        }

        .dr-value {
            font-weight: 600;
            color: var(--primary-color);
        }

        .category-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }

        .category-badge {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            color: var(--primary-color);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-xl);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.1);
            color: var(--text-primary);
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.show {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.171);
            z-index: 10000;
        }

        .spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid rgba(255, 107, 53, 0.3);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        .btn-top-analyze {
            margin-top: 0;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                top: 80px;
                left: 0;
                height: calc(100vh - 80px);
                z-index: 50;
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .sidebar.collapsed {
                margin-left: 0;
                transform: translateX(-100%);
            }

            .sidebar-toggle {
                display: block;
            }

            .main-content {
                width: 100%;
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
                margin: 0;
            }

            .card {
                padding: 1rem;
            }

            .header-content {
                padding: 0 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .table-container {
                overflow-x: auto;
            }

            .table-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .category-tags {
                justify-content: center;
            }

            .sidebar-content {
                padding: 1rem;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Dark mode specific adjustments */
        [data-theme="dark"] .upload-area {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
        }

        [data-theme="dark"] .filter-group {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
        }

        [data-theme="dark"] .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
        }

        [data-theme="dark"] .category-tag {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
        }

        [data-theme="dark"] .table th {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
        }

        [data-theme="dark"] .table tr:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-search"></i>
                    <span>Ahrefs Niche Finder</span>
                </div>
                <div class="header-controls">
                    <button class="sidebar-toggle" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">

                <!-- Upload Section -->
                <div class="upload-area" id="uploadArea">
                    <i class="upload-icon fas fa-cloud-upload-alt"></i>
                    <h3>Upload Ahrefs Content Explorer Data</h3>
                    <p>Drag and drop your CSV file here</p>
                    <input type="file" id="fileInput" class="file-input" accept=".csv,.xlsx,.xls">
                    <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-folder-open"></i>
                        Choose File
                    </button>
                    <p style="margin-top: 1rem; font-size: 0.75rem; color: var(--text-muted);">
                        CSV, Excel (.xlsx, .xls)
                    </p>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <!-- Priority Category (Software & SaaS) -->
                    <div class="priority-category">
                        <h4 style="margin-bottom: 1rem; color: #b8860b; font-weight: 600;">
                            <i class="fas fa-star"></i> Priority Category
                        </h4>
                        <div class="category-control-buttons">
                            <button class="btn btn-secondary" onclick="selectAllInGroup('priority-category')">Select All</button>
                            <button class="btn btn-secondary" onclick="deselectAllInGroup('priority-category')">Deselect All</button>
                        </div>
                        <div class="filter-grid">
                            <div class="filter-item">
                                <input type="checkbox" id="software" class="filter-checkbox category-checkbox priority-category-checkbox" checked>
                                <label for="software" class="filter-label">üíª Software & SaaS</label>
                            </div>
                        </div>
                    </div>

                    <!-- Key Business Areas -->
                    <div class="key-business-areas">
                        <h4 style="margin-bottom: 1rem; color: var(--primary-color); font-weight: 600;">
                            <i class="fas fa-briefcase"></i> Key Business Areas
                        </h4>
                        <div class="category-control-buttons">
                            <button class="btn btn-secondary" onclick="selectAllInGroup('key-business-areas')">Select All</button>
                            <button class="btn btn-secondary" onclick="deselectAllInGroup('key-business-areas')">Deselect All</button>
                        </div>
                        <div class="filter-grid">
                            <div class="filter-item">
                                <input type="checkbox" id="digitalmarketing" class="filter-checkbox category-checkbox key-business-areas-checkbox" checked>
                                <label for="digitalmarketing" class="filter-label">üìà Digital Marketing & SEO</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="businessfinance" class="filter-checkbox category-checkbox key-business-areas-checkbox" checked>
                                <label for="businessfinance" class="filter-label">üè¢ Business & Finance</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="realestate" class="filter-checkbox category-checkbox key-business-areas-checkbox" checked>
                                <label for="realestate" class="filter-label">üè† Real Estate</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="automotive" class="filter-checkbox category-checkbox key-business-areas-checkbox" checked>
                                <label for="automotive" class="filter-label">üöó Automotive</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="homeimprovement" class="filter-checkbox category-checkbox key-business-areas-checkbox" checked>
                                <label for="homeimprovement" class="filter-label">üè° Home Improvement & Gardening</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="construction" class="filter-checkbox category-checkbox key-business-areas-checkbox" checked>
                                <label for="construction" class="filter-label">üèóÔ∏è Construction & Engineering</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="manufacturing" class="filter-checkbox category-checkbox key-business-areas-checkbox" checked>
                                <label for="manufacturing" class="filter-label">üè≠ Manufacturing & Industrial</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="logistics" class="filter-checkbox category-checkbox key-business-areas-checkbox" checked>
                                <label for="logistics" class="filter-label">üöö Logistics & Supply Chain</label>
                            </div>
                        </div>
                    </div>

                    <!-- Website Purpose/Structure -->
                    <div class="website-purpose">
                        <h4 style="margin-bottom: 1rem; color: var(--success-color); font-weight: 600;">
                            <i class="fas fa-globe"></i> Website Purpose/Structure
                        </h4>
                        <div class="category-control-buttons">
                            <button class="btn btn-secondary" onclick="selectAllInGroup('website-purpose')">Select All</button>
                            <button class="btn btn-secondary" onclick="deselectAllInGroup('website-purpose')">Deselect All</button>
                        </div>
                        <div class="filter-grid">
                            <div class="filter-item">
                                <input type="checkbox" id="blogGuestPosting" class="filter-checkbox category-checkbox website-purpose-checkbox">
                                <label for="blogGuestPosting" class="filter-label">üìù Blog / Guest Posting</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="serviceBased" class="filter-checkbox category-checkbox website-purpose-checkbox">
                                <label for="serviceBased" class="filter-label">üõ†Ô∏è Service-Based</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="ecommerce" class="filter-checkbox category-checkbox website-purpose-checkbox">
                                <label for="ecommerce" class="filter-label">üõí E-commerce</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="marketplace" class="filter-checkbox category-checkbox website-purpose-checkbox">
                                <label for="marketplace" class="filter-label">üè™ Marketplace</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="portfolio" class="filter-checkbox category-checkbox website-purpose-checkbox">
                                <label for="portfolio" class="filter-label">üé® Portfolio & Showcase</label>
                            </div>
                        </div>
                    </div>

                    <!-- General Categories -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">
                            <i class="fas fa-th-large"></i>
                            General Categories
                        </h3>
                        <div class="category-control-buttons">
                            <button class="btn btn-secondary" onclick="selectAllInGroup('general-categories')">Select All</button>
                            <button class="btn btn-secondary" onclick="deselectAllInGroup('general-categories')">Deselect All</button>
                        </div>
                        <div class="filter-grid">
                            <div class="filter-item">
                                <input type="checkbox" id="business" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="business" class="filter-label">üíº Business</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="tech" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="tech" class="filter-label">‚öôÔ∏è Tech</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="fashion" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="fashion" class="filter-label">üëó Fashion</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="sports" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="sports" class="filter-label">‚öΩ Sports</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="travel" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="travel" class="filter-label">‚úàÔ∏è Travel</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="crypto" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="crypto" class="filter-label">‚Çø Crypto</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="finance" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="finance" class="filter-label">üí∞ Finance</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="education" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="education" class="filter-label">üìö Education</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="health" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="health" class="filter-label">üè• Health</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="law" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="law" class="filter-label">‚öñÔ∏è Law</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="lifestyle" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="lifestyle" class="filter-label">‚≠ê Lifestyle</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="wedding" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="wedding" class="filter-label">üíí Wedding</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="pets" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="pets" class="filter-label">üêæ Pets</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="photography" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="photography" class="filter-label">üì∏ Photography</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="entertainment" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="entertainment" class="filter-label">üé¨ Entertainment</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="food" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="food" class="filter-label">üçï Food</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="gaming" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="gaming" class="filter-label">üéÆ Gaming</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="apk" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="apk" class="filter-label">üì± APK</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="ios" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="ios" class="filter-label">üçé iOS</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="adult" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="adult" class="filter-label">üîû Adult</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="news" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="news" class="filter-label">üì∞ News & Media</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="science" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="science" class="filter-label">üî¨ Science & Research</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="art" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="art" class="filter-label">üé® Art & Design</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="music" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="music" class="filter-label">üéµ Music</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="books" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="books" class="filter-label">üìñ Books & Literature</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="nonprofit" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="nonprofit" class="filter-label">ü§ù Non-Profit & Charity</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="government" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="government" class="filter-label">üèõÔ∏è Government & Politics</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="religion" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="religion" class="filter-label">‚õ™ Religion & Spirituality</label>
                            </div>
                            <div class="filter-item">
                                <input type="checkbox" id="others" class="filter-checkbox category-checkbox general-categories-checkbox" checked>
                                <label for="others" class="filter-label">‚ùì Others</label>
                            </div>
                        </div>
                    </div>

                    <!-- Traffic Filters -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">
                            <i class="fas fa-chart-bar"></i>
                            Traffic Filters
                        </h3>
                        <div class="input-group">
                            <label class="input-label" for="minTraffic">Minimum Traffic</label>
                            <input type="number" id="minTraffic" class="input-field" value="1000" min="0">
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="maxTraffic">Maximum Traffic</label>
                            <input type="number" id="maxTraffic" class="input-field" value="1000000" min="0">
                        </div>
                    </div>

                    <!-- DR Filters -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">
                            <i class="fas fa-star"></i>
                            Domain Rating (DR) Filters
                        </h3>
                        <div class="input-group">
                            <label class="input-label" for="minDR">Minimum DR</label>
                            <input type="number" id="minDR" class="input-field" value="0" min="0" max="100">
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="maxDR">Maximum DR</label>
                            <input type="number" id="maxDR" class="input-field" value="100" min="0" max="100">
                        </div>
                    </div>

                    <!-- Geographic Filters -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">
                            <i class="fas fa-globe-americas"></i>
                            Geographic Filters
                        </h3>
                        <div id="countryFilters" class="filter-grid" style="max-height: 200px; overflow-y: auto;">
                            <!-- Country filters will be populated here -->
                        </div>
                        <div class="bulk-action-buttons">
                            <button class="btn btn-secondary" onclick="selectAllCountries()">Select All</button>
                            <button class="btn btn-secondary" onclick="unselectAllCountries()">Clear All</button>
                        </div>
                    </div>

                    <!-- Domain Extension Filters -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">
                            <i class="fas fa-link"></i>
                            Domain Extensions
                        </h3>
                        <div id="tldFilters" class="filter-grid" style="max-height: 200px; overflow-y: auto;">
                            <!-- TLD filters will be populated here -->
                        </div>
                        <div class="bulk-action-buttons">
                            <button class="btn btn-secondary" onclick="selectAllTlds()">Select All</button>
                            <button class="btn btn-secondary" onclick="unselectAllTlds()">Clear All</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary process-button" onclick="processData()">
                    <i class="fas fa-cogs"></i>
                    Analyze & Filter Data
                </button>

            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Loading -->
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Processing your Ahrefs data...</p>
                </div>

                <!-- Results Section -->
                <div class="results-section" id="resultsSection">
                    <!-- Statistics -->
                    <div class="card fade-in-up">
                        <div class="card-header">
                            <div class="header-left">
                                <i class="card-icon fas fa-chart-pie"></i>
                                <h2 class="card-title">Ahrefs Analytics Overview</h2>
                            </div>
                            <div class="header-right">
                                <button class="btn btn-primary process-button btn-top-analyze" onclick="processData()">
                                    <i class="fas fa-cogs"></i>
                                    Analyze & Filter Data
                                </button>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="totalWebsites">0</div>
                                <div class="stat-label">Total Websites</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalTraffic">0</div>
                                <div class="stat-label">Total Traffic</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="avgTraffic">0</div>
                                <div class="stat-label">Average Traffic</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="avgDR">0</div>
                                <div class="stat-label">Average DR</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="topCategory">-</div>
                                <div class="stat-label">Top Category</div>
                            </div>
                        </div>
                    </div>

                    <!-- Category Summary -->
                    <div class="card fade-in-up">
                        <div class="card-header">
                            <i class="card-icon fas fa-tags"></i>
                            <h2 class="card-title">Category Summary</h2>
                            <button class="btn btn-success" onclick="downloadResults()">
                                <i class="fas fa-download"></i>
                                Download Results
                            </button>
                        </div>
                        <div class="category-tags" id="categoryTags">
                            <!-- Category tags will be populated here -->
                        </div>
                        <button class="btn btn-secondary" id="clearCategoryFilter" onclick="clearCategoryFilter()"
                            style="display: none;">
                            <i class="fas fa-times"></i>
                            Clear Category Filter
                        </button>
                    </div>

                    <!-- Results Table -->
                    <div class="card fade-in-up">
                        <div class="card-header">
                            <i class="card-icon fas fa-table"></i>
                            <h2 class="card-title">Filtered Results</h2>
                        </div>
                        <div class="table-container">
                            <div class="table-controls">
                                <input type="text" id="searchInput" class="input-field" placeholder="Search websites..."
                                    style="flex: 1; min-width: 200px;">
                                <select id="sortSelect" class="input-field" onchange="sortResults()"
                                    style="min-width: 200px;">
                                    <option value="traffic-desc">Traffic (High to Low)</option>
                                    <option value="traffic-asc">Traffic (Low to High)</option>
                                    <option value="dr-desc">DR (High to Low)</option>
                                    <option value="dr-asc">DR (Low to High)</option>
                                    <option value="domain-asc">Domain (A to Z)</option>
                                    <option value="domain-desc">Domain (Z to A)</option>
                                </select>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th data-sort="url">Website <i class="fas fa-sort"></i></th>
                                        <th data-sort="traffic">Traffic <i class="fas fa-sort"></i></th>
                                        <th data-sort="dr">DR <i class="fas fa-sort"></i></th>
                                        <th data-sort="categories">Categories <i class="fas fa-sort"></i></th>
                                        <th data-sort="tld">Domain Extension <i class="fas fa-sort"></i></th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTable">
                                    <!-- Results will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Notification</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modalMessage"></div>
            <div style="margin-top: 1.5rem; text-align: right;">
                <button class="btn btn-primary" onclick="closeModal()">OK</button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced category keywords with more comprehensive detection and new categories
        const categoryKeywords = {
            // Priority Category
            software: ["software", "saas", "app", "platform", "tool", "cloud", "api", "dashboard", "crm", "erp", "automation", "integration", "system", "solution", "download", "tech solution", "application", "program", "software development", "web app", "mobile app", "enterprise software", "productivity tool", "cybersecurity", "data management", "analytics platform"],

            // Key Business Areas
            digitalmarketing: ["seo", "marketing", "advertising", "analytics", "social media", "ppc", "email marketing", "conversion", "campaign", "digital", "adwords", "facebook ads", "instagram marketing", "content marketing", "growth hacking", "branding", "public relations", "influencer marketing", "marketing strategy", "online presence", "lead generation", "web analytics", "search engine optimization"],
            businessfinance: ["business", "finance", "banking", "investment", "accounting", "invoice", "billing", "payment", "financial planning", "revenue", "profit", "enterprise solutions", "startup funding", "venture capital", "loan", "credit", "insurance", "stock market", "forex", "cryptocurrency investment", "wealth management", "taxation", "audit", "financial advisory"],
            realestate: ["real estate", "property", "homes", "houses", "apartments", "condos", "rental", "mortgage", "realtor", "mls", "listing", "buy home", "sell home", "rent", "lease", "commercial property", "land development", "property management", "real estate investment", "housing market", "brokerage", "appraisal"],
            automotive: ["automotive", "cars", "auto", "vehicle", "truck", "motorcycle", "parts", "repair", "dealership", "used cars", "new cars", "car insurance", "auto loan", "electric vehicles", "car reviews", "auto sales", "mechanic", "car accessories", "tuning", "classic cars"],
            homeimprovement: ["home improvement", "gardening", "landscaping", "renovation", "remodeling", "diy", "tools", "hardware", "garden", "plants", "lawn care", "interior design", "construction", "plumbing", "electrical", "roofing", "painting", "kitchen remodel", "bathroom remodel", "sustainable living", "home decor"],
            construction: ["construction", "engineering", "building", "contractor", "architecture", "civil engineering", "structural engineering", "project management", "heavy machinery", "excavation", "foundation", "concrete", "steel", "infrastructure", "commercial construction", "residential construction", "road construction", "bridge construction"],
            manufacturing: ["manufacturing", "industrial", "factory", "production", "assembly", "machinery", "equipment", "supply chain", "quality control", "lean manufacturing", "automation", "robotics", "industrial design", "process optimization", "industrial equipment", "heavy industry", "chemical manufacturing", "textile manufacturing"],
            logistics: ["logistics", "supply chain", "shipping", "freight", "transportation", "warehouse", "distribution", "delivery", "cargo", "fleet management", "inventory management", "third party logistics", "fulfillment", "courier", "express delivery", "international shipping", "customs", "import export"],

            // Website Purpose/Structure
            blogGuestPosting: ["blog", "blogs", "article", "articles", "news", "insights", "updates", "guest post", "write for us", "contribute", "editorial", "submissions", "author guidelines", "content hub", "latest posts", "our blog", "publication", "stories", "journal", "magazine", "column", "opinion", "commentary", "press release", "publishing platform"],
            serviceBased: ["services", "solutions", "consulting", "agency", "hire us", "our work", "portfolio", "request quote", "pricing", "packages", "offerings", "capabilities", "expertise", "get started", "contact us for services", "managed services", "professional services", "our services", "book a demo", "schedule consultation", "support", "maintenance", "installation", "repair services", "custom solutions", "on-demand service"],
            ecommerce: ["shop", "store", "cart", "checkout", "buy now", "products", "add to cart", "catalog", "sale", "online store", "marketplace", "e-shop", "browse products", "view cart", "order", "wishlist", "my account", "new arrivals", "bestsellers", "collections", "deals", "discounts", "shipping", "payment gateway", "product reviews", "shopping cart", "online retail", "dropshipping"],
            marketplace: ["marketplace", "multi-vendor", "seller", "vendor", "commission", "listing fee", "product listing", "seller dashboard", "buyer protection", "escrow", "rating system", "review system", "seller verification", "marketplace platform", "online marketplace", "digital marketplace", "b2b marketplace", "c2c marketplace"],
            portfolio: ["portfolio", "showcase", "gallery", "work samples", "case studies", "projects", "creative work", "design portfolio", "photography portfolio", "artist portfolio", "freelancer portfolio", "agency portfolio", "personal website", "creative showcase", "professional portfolio"],

            // General Categories
            business: ["business", "company", "corporate", "enterprise", "startup", "entrepreneur", "industry", "commerce", "trade", "management", "strategy", "corporation", "small business", "b2b", "b2c", "franchise", "investment opportunities", "market analysis", "business development"],
            tech: ["tech", "technology", "hardware", "programming", "developer", "code", "digital transformation", "computer science", "gadget", "innovation", "it services", "software engineering", "artificial intelligence", "machine learning", "cybersecurity", "data science", "web development", "mobile development", "cloud computing", "robotics", "biotechnology", "nanotechnology"],
            fashion: ["fashion", "style", "clothing", "dress", "apparel", "outfit", "beauty", "models", "designer", "trend", "couture", "runway", "accessories", "jewelry", "footwear", "haute couture", "ready-to-wear", "fashion show", "fashion blog", "style guide", "makeup", "skincare", "perfume"],
            sports: ["sports", "fitness", "gym", "workout", "exercise", "athlete", "team", "game", "competition", "training", "coaching", "nutrition", "sports equipment", "sports news", "leagues", "championships", "olympics", "marathon", "yoga", "pilates", "bodybuilding", "personal trainer"],
            travel: ["travel", "tourism", "vacation", "destination", "hotel", "flight", "tour", "trip", "holiday", "adventure", "booking", "itinerary", "resort", "cruise", "backpacking", "travel guide", "travel agency", "sightseeing", "expedition", "explore", "wanderlust", "accommodation"],
            crypto: ["crypto", "cryptocurrency", "bitcoin", "blockchain", "ethereum", "trading", "wallet", "mining", "defi", "nft", "altcoin", "decentralized finance", "crypto exchange", "token", "smart contract", "web3", "metaverse", "digital asset"],
            finance: ["finance", "money", "invest", "stock market", "trading", "economy", "fund", "wealth management", "personal finance", "loans", "credit cards", "budgeting", "retirement planning", "mortgage rates", "insurance policies", "financial news", "investment banking", "private equity"],
            education: ["education", "school", "university", "college", "learn", "student", "teach", "academic", "course", "tutor", "online learning", "edtech", "curriculum", "degree", "diploma", "vocational training", "e-learning", "classroom", "lecture", "research", "scholarship"],
            health: ["health", "medical", "wellness", "fitness", "doctor", "hospital", "diet", "nutrition", "medicine", "healthcare", "mental health", "therapy", "disease", "symptom", "treatment", "pharmacy", "clinic", "diagnosis", "prevention", "public health", "alternative medicine", "holistic health", "supplements", "exercise routine", "healthy eating"],
            law: ["law", "legal", "lawyer", "attorney", "court", "litigation", "legal advice", "law firm", "paralegal", "legal services", "justice", "rights", "regulation", "legislation", "jurisprudence", "advocacy", "counsel", "bar association", "legal aid"],
            lifestyle: ["lifestyle", "living", "home", "family", "relationships", "personal development", "self improvement", "wellness", "mindfulness", "hobbies", "leisure", "well-being", "happiness", "personal growth", "motivation", "inspiration", "daily routine", "work-life balance"],
            wedding: ["wedding", "marriage", "bride", "groom", "ceremony", "reception", "wedding planning", "bridal", "engagement", "wedding dress", "wedding photographer", "wedding venue", "invitations", "honeymoon", "wedding favors", "wedding rings", "vows", "anniversary"],
            pets: ["pets", "dogs", "cats", "animals", "veterinary", "pet care", "pet supplies", "grooming", "training", "adoption", "animal welfare", "breeds", "pet food", "aquarium", "reptiles", "birds", "exotic pets"],
            photography: ["photography", "photo", "camera", "photographer", "portrait", "wedding photography", "studio", "editing", "lens", "aperture", "shutter speed", "composition", "lighting", "photo editing software", "fine art photography", "landscape photography", "street photography"],
            entertainment: ["entertainment", "movies", "music", "games", "tv shows", "celebrities", "streaming", "media", "fun", "concert", "theater", "comedy", "art", "culture", "event", "festival", "nightlife", "leisure activities", "pop culture", "fandom"],
            food: ["food", "restaurant", "recipe", "cooking", "cuisine", "meal", "dining", "chef", "kitchen", "culinary", "foodie", "food delivery", "catering", "baking", "drinks", "beverages", "wine", "beer", "cocktails", "gastronomy", "dietary restrictions", "vegan", "vegetarian", "gluten-free"],
            gaming: ["gaming", "games", "video games", "esports", "gamer", "console", "pc gaming", "mobile gaming", "twitch", "stream", "walkthrough", "cheats", "mods", "multiplayer", "single player", "rpg", "fps", "strategy game", "indie game", "game development", "game reviews", "gaming news", "game community"],
            apk: ["apk", "android app", "android game", "apk download", "mod apk", "apk mirror", "android application package", "mobile app download", "android software", "apk installer", "android updates", "android tips", "android tricks", "android customization"],
            ios: ["ios", "iphone app", "ipad app", "apple app", "ios game", "app store", "ios download", "apple software", "ios updates", "ios tips", "ios tricks", "ios development", "apple ecosystem", "mac app", "apple watch app"],
            adult: ["porn", "adult content", "xxx", "erotic", "mature content", "adult entertainment", "webcam", "dating adult", "adult dating", "onlyfans", "patreon adult", "sex education", "sexual health", "adult toys", "adult films", "adult games", "adult literature", "adult art", "adult community", "adult forum", "adult chat", "adult services", "adult products", "adult dating site", "adult video", "adult website", "adult streaming", "adult subscription", "adult membership", "adult club", "adult store", "adult shop", "adult magazine", "adult comic", "adult animation", "adult cartoon", "adult manga", "adult anime", "adult novel", "adult story", "adult fanfiction", "adult roleplay", "adult vr", "adult ar", "adult ai", "adult chatbot", "adult companion", "adult doll", "adult robot", "adult virtual reality", "adult augmented reality", "adult artificial intelligence"],
            
            // New Categories
            news: ["news", "media", "journalism", "newspaper", "magazine", "breaking news", "current events", "press", "reporter", "editor", "broadcast", "television", "radio", "podcast", "media outlet", "news agency", "correspondent", "headline", "article", "story", "investigation", "interview"],
            science: ["science", "research", "laboratory", "experiment", "study", "scientific", "biology", "chemistry", "physics", "astronomy", "geology", "environmental science", "climate change", "renewable energy", "sustainability", "innovation", "discovery", "academic research", "peer review", "scientific journal"],
            art: ["art", "design", "creative", "artist", "designer", "graphic design", "illustration", "painting", "sculpture", "digital art", "fine art", "contemporary art", "modern art", "abstract art", "visual arts", "creative agency", "design studio", "art gallery", "museum", "exhibition"],
            music: ["music", "musician", "band", "singer", "songwriter", "composer", "album", "song", "concert", "festival", "recording", "studio", "instrument", "guitar", "piano", "drums", "vocals", "melody", "rhythm", "genre", "classical", "jazz", "rock", "pop", "electronic", "hip hop"],
            books: ["books", "literature", "author", "writer", "novel", "poetry", "publishing", "publisher", "bookstore", "library", "reading", "fiction", "non-fiction", "biography", "memoir", "textbook", "academic book", "bestseller", "book review", "literary", "manuscript", "editing"],
            nonprofit: ["nonprofit", "charity", "foundation", "donation", "volunteer", "fundraising", "social cause", "humanitarian", "community service", "philanthropy", "non-governmental organization", "ngo", "social impact", "awareness campaign", "advocacy", "social justice", "environmental protection", "human rights"],
            government: ["government", "politics", "political", "policy", "legislation", "public service", "civic", "democracy", "election", "voting", "campaign", "politician", "senator", "congressman", "mayor", "governor", "president", "municipal", "federal", "state", "local government", "public administration"],
            religion: ["religion", "religious", "spiritual", "faith", "church", "temple", "mosque", "synagogue", "prayer", "worship", "bible", "quran", "torah", "christianity", "islam", "judaism", "buddhism", "hinduism", "meditation", "pilgrimage", "religious community", "theology", "ministry", "pastor", "priest", "imam"],
            
            // Others category for uncategorized items
            others: ["others", "miscellaneous", "general", "various", "mixed", "diverse", "uncategorized", "unspecified", "other"]
        };

        // Country and TLD data
        const countriesData = [
            { name: "USA", codes: ["us", "com"] },
            { name: "UK", codes: ["uk", "co.uk"] },
            { name: "Canada", codes: ["ca"] },
            { name: "Australia", codes: ["au", "com.au"] },
            { name: "Germany", codes: ["de"] },
            { name: "India", codes: ["in", "co.in"] },
            { name: "France", codes: ["fr"] },
            { name: "Japan", codes: ["jp", "co.jp"] },
            { name: "China", codes: ["cn", "com.cn"] },
            { name: "Brazil", codes: ["br", "com.br"] }
        ].sort((a, b) => a.name.localeCompare(b.name));

        const tldList = [
            ".com", ".net", ".org", ".co", ".io", ".ai", ".app", ".dev", ".tech", ".store",
            ".co.uk", ".ca", ".de", ".au", ".in", ".us", ".fr", ".jp", ".cn", ".br"
        ].sort();

        // Global variables
        let allResults = [];
        let filteredResults = [];
        let categorySummary = {};
        let currentTheme = 'light';
        let currentSortColumn = 'traffic';
        let currentSortDirection = 'desc';

        // Utility functions
        function getTldFromUrl(url) {
            if (!url) return '';
            try {
                let tempUrl = url;
                if (!tempUrl.match(/^https?:\/\//)) {
                    tempUrl = 'https://' + tempUrl;
                }
                const hostname = new URL(tempUrl).hostname;
                const parts = hostname.split('.');
                if (parts.length < 2) return '';

                // Handle common second-level domains
                const commonSLDs = ['co', 'com', 'org', 'net', 'gov', 'edu'];
                if (parts.length > 2 && commonSLDs.includes(parts[parts.length - 2])) {
                    return `.${parts[parts.length - 2]}.${parts[parts.length - 1]}`;
                }
                return `.${parts[parts.length - 1]}`;
            } catch (e) {
                return '';
            }
        }

        function detectCategory(url, content = '') {
            const normalizedUrl = url.toLowerCase();
            const normalizedContent = content.toLowerCase();
            const detectedCategories = new Set();

            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                if (category === 'others') continue; // Skip 'others' category in detection
                
                for (const keyword of keywords) {
                    if (normalizedUrl.includes(keyword) || normalizedContent.includes(keyword)) {
                        detectedCategories.add(category);
                    }
                }
            }

            // If no categories detected, assign to 'others'
            return detectedCategories.size > 0 ? Array.from(detectedCategories) : ['others'];
        }

        function getCategoryDisplayName(category) {
            const displayNames = {
                // Priority Category
                software: 'Software & SaaS',

                // Key Business Areas
                digitalmarketing: 'Digital Marketing & SEO',
                businessfinance: 'Business & Finance',
                realestate: 'Real Estate',
                automotive: 'Automotive',
                homeimprovement: 'Home Improvement & Gardening',
                construction: 'Construction & Engineering',
                manufacturing: 'Manufacturing & Industrial',
                logistics: 'Logistics & Supply Chain',

                // Website Purpose/Structure
                blogGuestPosting: 'Blog / Guest Posting',
                serviceBased: 'Service-Based',
                ecommerce: 'E-commerce',
                marketplace: 'Marketplace',
                portfolio: 'Portfolio & Showcase',

                // General Categories
                business: 'Business',
                tech: 'Tech',
                fashion: 'Fashion',
                sports: 'Sports',
                travel: 'Travel',
                crypto: 'Crypto',
                finance: 'Finance',
                education: 'Education',
                health: 'Health',
                law: 'Law',
                lifestyle: 'Lifestyle',
                wedding: 'Wedding',
                pets: 'Pets',
                photography: 'Photography',
                entertainment: 'Entertainment',
                food: 'Food',
                gaming: 'Gaming',
                apk: 'APK',
                ios: 'iOS',
                adult: 'Adult',
                news: 'News & Media',
                science: 'Science & Research',
                art: 'Art & Design',
                music: 'Music',
                books: 'Books & Literature',
                nonprofit: 'Non-Profit & Charity',
                government: 'Government & Politics',
                religion: 'Religion & Spirituality',
                others: 'Others'
            };
            return displayNames[category] || category.charAt(0).toUpperCase() + category.slice(1);
        }

        // Select/Deselect functions for category groups
        function selectAllInGroup(groupClass) {
            const checkboxes = document.querySelectorAll(`.${groupClass}-checkbox`);
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            if (allResults.length > 0) processData();
        }

        function deselectAllInGroup(groupClass) {
            const checkboxes = document.querySelectorAll(`.${groupClass}-checkbox`);
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            if (allResults.length > 0) processData();
        }

        function processData() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                showModal("Please select a file to upload.", "File Required");
                return;
            }

            const minTraffic = parseInt(document.getElementById('minTraffic').value) || 0;
            const maxTraffic = parseInt(document.getElementById('maxTraffic').value) || Number.MAX_SAFE_INTEGER;
            const minDR = parseInt(document.getElementById('minDR').value) || 0;
            const maxDR = parseInt(document.getElementById('maxDR').value) || 100;

            // Get selected filters
            const selectedCategories = Array.from(document.querySelectorAll('.category-checkbox:checked')).map(cb => cb.id);
            const selectedCountries = Array.from(document.querySelectorAll('.country-checkbox:checked')).map(cb => cb.value);
            const selectedTlds = Array.from(document.querySelectorAll('.tld-checkbox:checked')).map(cb => cb.value);

            // Show loading
            document.getElementById('loading').classList.add('show');

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" });

                    allResults = [];

                    jsonData.forEach(row => {
                        let url = '', traffic = 0, dr = 0, content = '';
                        let totalPages = 0, trafficValue = 0, avgRefDomains = 0;

                        // Extract data strictly based on CSV headers
                        for (const key of Object.keys(row)) {
                            const lKey = key.toLowerCase().trim();
                            
                            // Extract website domain (note: CSV has "Webiste" typo)
                            if (lKey === 'webiste' || lKey === 'website') {
                                url = String(row[key]).trim();
                                // Remove trailing slash if present
                                if (url.endsWith('/')) {
                                    url = url.slice(0, -1);
                                }
                            }
                            
                            // Extract traffic from "Total traffic" column
                            if (lKey === 'total traffic') {
                                traffic = parseInt(row[key]) || 0;
                            }
                            
                            // Extract DR from "DR" column
                            if (lKey === 'dr') {
                                dr = parseInt(row[key]) || 0;
                            }
                            
                            // Extract additional metrics for enhanced analysis
                            if (lKey === 'total pages') {
                                totalPages = parseInt(row[key]) || 0;
                            }
                            
                            if (lKey === 'traffic value') {
                                trafficValue = parseInt(row[key]) || 0;
                            }
                            
                            if (lKey === 'avg. ref. domains') {
                                avgRefDomains = parseInt(row[key]) || 0;
                            }
                        }

                        if (!url || traffic < minTraffic || traffic > maxTraffic || dr < minDR || dr > maxDR) return;

                        const categories = detectCategory(url, content.trim());
                        const tld = getTldFromUrl(url);

                        // Apply filters
                        if (selectedCategories.length > 0 && !selectedCategories.some(sc => categories.includes(sc))) return;

                        if (selectedCountries.length > 0) {
                            const matchesCountry = selectedCountries.some(country => {
                                const countryData = countriesData.find(c => c.name === country);
                                return countryData && countryData.codes.some(code => tld.includes(code));
                            });
                            if (!matchesCountry) return;
                        }

                        if (selectedTlds.length > 0 && !selectedTlds.includes(tld)) return;

                        allResults.push({
                            url,
                            traffic,
                            dr,
                            categories,
                            tld,
                            content: content.trim()
                        });
                    });

                    // Sort by traffic (highest first) initially
                    allResults.sort((a, b) => b.traffic - a.traffic);
                    filteredResults = [...allResults];

                    // Hide loading and show results
                    document.getElementById('loading').classList.remove('show');
                    displayResults();

                } catch (error) {
                    document.getElementById('loading').classList.remove('show');
                    console.error('Error processing file:', error);
                    showModal(`Error processing file: ${error.message}`, 'Processing Error');
                }
            };

            reader.onerror = () => {
                document.getElementById('loading').classList.remove('show');
                showModal('Error reading file.', 'File Error');
            };

            reader.readAsArrayBuffer(file);
        }

        function displayResults() {
            // Update statistics
            updateStatistics();

            // Create category summary
            createCategorySummary();

            // Display results table
            displayResultsTable();

            // Show results section
            document.getElementById('resultsSection').classList.add('show');
        }

        function updateStatistics() {
            const totalWebsites = filteredResults.length;
            const totalTraffic = filteredResults.reduce((sum, site) => sum + site.traffic, 0);
            const avgTraffic = totalWebsites > 0 ? Math.round(totalTraffic / totalWebsites) : 0;
            const avgDR = totalWebsites > 0 ? Math.round(filteredResults.reduce((sum, site) => sum + site.dr, 0) / totalWebsites) : 0;

            // Find top category
            const categoryCount = {};
            filteredResults.forEach(site => {
                site.categories.forEach(cat => {
                    categoryCount[cat] = (categoryCount[cat] || 0) + 1;
                });
            });
            const topCategory = Object.keys(categoryCount).reduce((a, b) =>
                categoryCount[a] > categoryCount[b] ? a : b, 'None');

            document.getElementById('totalWebsites').textContent = totalWebsites.toLocaleString();
            document.getElementById('totalTraffic').textContent = totalTraffic.toLocaleString();
            document.getElementById('avgTraffic').textContent = avgTraffic.toLocaleString();
            document.getElementById('avgDR').textContent = avgDR;
            document.getElementById('topCategory').textContent = getCategoryDisplayName(topCategory);
        }

        function createCategorySummary() {
            categorySummary = {};
            filteredResults.forEach(site => {
                site.categories.forEach(cat => {
                    categorySummary[cat] = (categorySummary[cat] || 0) + 1;
                });
            });

            const categoryTagsContainer = document.getElementById('categoryTags');
            categoryTagsContainer.innerHTML = '';

            Object.entries(categorySummary)
                .sort((a, b) => b[1] - a[1])
                .forEach(([category, count]) => {
                    const tag = document.createElement('span');
                    tag.className = 'category-tag';
                    tag.textContent = `${getCategoryDisplayName(category)}: ${count}`;
                    tag.dataset.category = category;
                    tag.addEventListener('click', () => filterByCategory(category));
                    categoryTagsContainer.appendChild(tag);
                });
        }

        function displayResultsTable() {
            const tableBody = document.getElementById('resultsTable');
            tableBody.innerHTML = '';

            if (filteredResults.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                            No websites found matching your criteria.
                        </td>
                    </tr>
                `;
                return;
            }

            filteredResults.forEach(site => {
                const row = document.createElement('tr');
                let fullUrl = site.url;
                if (!fullUrl.startsWith('http://') && !fullUrl.startsWith('https://')) {
                    fullUrl = 'https://' + fullUrl;
                }

                row.innerHTML = `
                    <td>
                        <a href="${fullUrl}" target="_blank" class="website-link">
                            <i class="fas fa-external-link-alt"></i>
                            ${site.url}
                        </a>
                    </td>
                    <td class="traffic-value">${site.traffic.toLocaleString()}</td>
                    <td class="dr-value">${site.dr}</td>
                    <td>
                        <div class="category-badges">
                            ${site.categories.map(cat =>
                    `<span class="category-badge">${getCategoryDisplayName(cat)}</span>`
                ).join('')}
                        </div>
                    </td>
                    <td>${site.tld || 'N/A'}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="viewDetails('${site.url}')" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                            <i class="fas fa-info-circle"></i>
                            Details
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function filterByCategory(category) {
            // Update active state
            document.querySelectorAll('.category-tag').forEach(tag => {
                tag.classList.toggle('active', tag.dataset.category === category);
            });

            // Filter results
            filteredResults = allResults.filter(site => site.categories.includes(category));

            // Update display
            displayResultsTable();
            updateStatistics();

            // Show clear filter button
            document.getElementById('clearCategoryFilter').style.display = 'block';
        }

        function clearCategoryFilter() {
            document.querySelectorAll('.category-tag').forEach(tag => {
                tag.classList.remove('active');
            });

            filteredResults = [...allResults];
            displayResultsTable();
            updateStatistics();

            document.getElementById('clearCategoryFilter').style.display = 'none';
        }

        function filterResults() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allResults.filter(site =>
                site.url.toLowerCase().includes(searchTerm) ||
                site.categories.some(cat => getCategoryDisplayName(cat).toLowerCase().includes(searchTerm))
            );

            filteredResults = filtered;
            sortResults(); // Re-sort after filtering
            displayResultsTable();
            updateStatistics();
        }

        function sortResults() {
            const sortValue = document.getElementById('sortSelect').value;
            const [sortBy, sortDirection] = sortValue.split('-');

            filteredResults.sort((a, b) => {
                let valA, valB;

                switch (sortBy) {
                    case 'domain':
                        valA = a.url.toLowerCase();
                        valB = b.url.toLowerCase();
                        return sortDirection === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
                    case 'traffic':
                        valA = a.traffic;
                        valB = b.traffic;
                        return sortDirection === 'asc' ? valA - valB : valB - valA;
                    case 'dr':
                        valA = a.dr;
                        valB = b.dr;
                        return sortDirection === 'asc' ? valA - valB : valB - valA;
                    case 'categories':
                        valA = a.categories.map(getCategoryDisplayName).sort().join(', ').toLowerCase();
                        valB = b.categories.map(getCategoryDisplayName).sort().join(', ').toLowerCase();
                        return sortDirection === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
                    default:
                        return 0;
                }
            });

            displayResultsTable();
        }

        function downloadResults() {
            if (filteredResults.length === 0) {
                showModal('No results to download.', 'Download Info');
                return;
            }

            const exportData = filteredResults.map(site => ({
                Website: site.url,
                Traffic: site.traffic,
                DR: site.dr,
                Categories: site.categories.map(getCategoryDisplayName).join(', '),
                'Domain Extension': site.tld,
                Content: site.content
            }));

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "AhrefsNicheResults");
            XLSX.writeFile(wb, "ahrefs_niche_analysis_results.xlsx");
        }

        function viewDetails(url) {
            const site = filteredResults.find(s => s.url === url);
            if (site) {
                const details = `
                    <strong>Website:</strong> ${site.url}<br>
                    <strong>Traffic:</strong> ${site.traffic.toLocaleString()}<br>
                    <strong>Domain Rating (DR):</strong> ${site.dr}<br>
                    <strong>Categories:</strong> ${site.categories.map(getCategoryDisplayName).join(', ')}<br>
                    <strong>Domain Extension:</strong> ${site.tld}<br>
                    <strong>Content Preview:</strong> ${site.content.substring(0, 200)}...
                `;
                showModal(details, 'Website Details');
            }
        }

        // Utility functions
        function selectAllCountries() {
            document.querySelectorAll('.country-checkbox').forEach(cb => cb.checked = true);
        }

        function unselectAllCountries() {
            document.querySelectorAll('.country-checkbox').forEach(cb => cb.checked = false);
        }

        function selectAllTlds() {
            document.querySelectorAll('.tld-checkbox').forEach(cb => cb.checked = true);
        }

        function unselectAllTlds() {
            document.querySelectorAll('.tld-checkbox').forEach(cb => cb.checked = false);
        }

        function showModal(message, title = 'Notification') {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').innerHTML = message;
            document.getElementById('modal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }

        // Close modal when clicking outside
        document.getElementById('modal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function (e) {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.querySelector('.sidebar-toggle');

            if (window.innerWidth <= 1024 &&
                !sidebar.contains(e.target) &&
                !sidebarToggle.contains(e.target) &&
                sidebar.classList.contains('show')) {
                sidebar.classList.remove('show');
            }
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function () {
            initializeFilters();
            setupEventListeners();
            loadTheme();
        });

        function initializeFilters() {
            // Populate country filters
            const countryFiltersContainer = document.getElementById('countryFilters');
            countryFiltersContainer.innerHTML = countriesData.map(country => `
                <div class="filter-item">
                    <input type="checkbox" id="country-${country.name.toLowerCase().replace(/\s/g, '')}" class="filter-checkbox country-checkbox" value="${country.name}" checked>
                    <label for="country-${country.name.toLowerCase().replace(/\s/g, '')}" class="filter-label">${country.name}</label>
                </div>
            `).join('');

            // Populate TLD filters
            const tldFiltersContainer = document.getElementById('tldFilters');
            tldFiltersContainer.innerHTML = tldList.map(tld => `
                <div class="filter-item">
                    <input type="checkbox" id="tld-${tld.replace(/\./g, '')}" class="filter-checkbox tld-checkbox" value="${tld}" checked>
                    <label for="tld-${tld.replace(/\./g, '')}" class="filter-label">${tld}</label>
                </div>
            `).join('');
        }

        function setupEventListeners() {
            // File input change event
            document.getElementById('fileInput').addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const uploadArea = document.getElementById('uploadArea');
                    const h3 = uploadArea.querySelector('h3');
                    h3.textContent = file.name;
                }
            });

            // Drag and drop events
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    document.getElementById('fileInput').files = files;
                    const h3 = uploadArea.querySelector('h3');
                    h3.textContent = files[0].name;
                }
            });

            // Add event listeners for sorting table headers
            document.querySelectorAll('.table th[data-sort]').forEach(header => {
                header.style.cursor = 'pointer';
                header.addEventListener('click', () => {
                    const sortBy = header.dataset.sort;
                    if (currentSortColumn === sortBy) {
                        currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSortColumn = sortBy;
                        currentSortDirection = 'asc';
                    }
                    
                    // Update select dropdown
                    document.getElementById('sortSelect').value = `${sortBy}-${currentSortDirection}`;
                    sortResults();
                });
            });

            // Search input
            document.getElementById('searchInput').addEventListener('keyup', filterResults);
            
            // Traffic and DR filters
            document.getElementById('minTraffic').addEventListener('change', function() {
                if (allResults.length > 0) processData();
            });
            document.getElementById('maxTraffic').addEventListener('change', function() {
                if (allResults.length > 0) processData();
            });
            document.getElementById('minDR').addEventListener('change', function() {
                if (allResults.length > 0) processData();
            });
            document.getElementById('maxDR').addEventListener('change', function() {
                if (allResults.length > 0) processData();
            });

            // Category checkboxes
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('category-checkbox') || 
                    e.target.classList.contains('country-checkbox') || 
                    e.target.classList.contains('tld-checkbox')) {
                    if (allResults.length > 0) processData();
                }
            });
        }

        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            if (body.dataset.theme === 'dark') {
                body.dataset.theme = 'light';
                themeIcon.className = 'fas fa-moon';
                currentTheme = 'light';
            } else {
                body.dataset.theme = 'dark';
                themeIcon.className = 'fas fa-sun';
                currentTheme = 'dark';
            }
            localStorage.setItem('theme', currentTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                currentTheme = savedTheme;
                document.body.dataset.theme = savedTheme;
                document.getElementById('themeIcon').className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }
    </script>
</body>

</html>

